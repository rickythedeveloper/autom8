<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Edit scheme</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
</head>
<body style="background: white;">

    <h1 id="schemeName">Scheme name</h1>
    <main class='row'>
        <div class="col-8" id="processes">
            <!-- <p>hello</p> -->
            <!-- <input type="button" value='hello'> -->
            <a href="https://bbc.co.uk" target='_blank'>bbc man</a>
        </div>
        <div class="col">
            <p>hello</p>
        </div>
    </main>
</body>

<script>
    const { ipcRenderer } = require('electron')

    // get the scheme id
    schemeID = getSchemeId()

    // based on the reply to the data request with scheme id, complete html
    ipcRenderer.on('requestSchemeData-reply', (event, schemeData) => {
        setupPage(schemeData)
    })

    // request all the data with the id obtained
    ipcRenderer.send('requestSchemeData', schemeID)

    function getSchemeId() {
        const querystring = require('querystring');
        let query = querystring.parse(global.location.search);
        if (query == null) {
            console.log('No scheme id found (no query was completed when edit scheme page opened')
        }
        if ('?schemeID' in query) {
            return query['?schemeID']
        } else {
            console.log('No scheme id found (query does not contain scheme id')
            return null
        }
    }

    function setupPage(schemeData) {
        setSchemeName(schemeData)
        addProcessElems(schemeData)
    }

    function setSchemeName(schemeData) {
        schemeNameElem = document.getElementById('schemeName')
        schemeNameElem.innerHTML = schemeData.schemeName
    }

    function addProcessElems(schemeData) {
        processesElem = document.getElementById('processes')
        processes = schemeData.processes
        for (process of processes) {
            var processElem = document.createElement('p')
            processElem.innerHTML = process.processName
            setOnClick(processElem, process)
            processElem.style.backgroundColor = 'red'
            processesElem.appendChild(processElem)
        }
    }

    function setOnClick(element, process) {
        element.onclick = function() {
            if (process['type'] == 'openURLInBrowser') {
                ipcRenderer.send('openURLInBrowser', process['url'])
            }
        }
    }

</script>

</html>